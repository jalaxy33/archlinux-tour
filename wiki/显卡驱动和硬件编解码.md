
这一章介绍与显卡相关的通用配置，需要根据自己的硬件与系统内核的实际情况来选择合适的固件和软件。

## 检查头文件

之前没装的现在需要装上，需要根据自己的内核来安装对应的头文件。

- `linux`内核

    ```sh
    sudo pacman -S -needed linux-headers
    ```

- `linux-zen`内核
    ```sh
    sudo pacman -S -needed linux-zen-headers
    ```

- `linux-lts`内核

    ```sh
    sudo pacman -S -needed linux-lts-headers
    ```



## 安装显卡驱动

CPU和GPU都需要安装显卡驱动，根据自己的硬件实际情况安装。

### Intel

[Archwiki - intel graphics](https://wiki.archlinux.org/title/Intel_graphics)

```sh
sudo pacman -S --needed mesa lib32-mesa vulkan-intel lib32-vulkan-intel 
```

### AMD

[Archwiki - AMDGPU](https://wiki.archlinux.org/title/AMDGPU)

A卡不需要自己额外安装驱动，已经由`linux-firmware`和`mesa`提供。可以安装一下vulkan驱动。

```sh
sudo pacman -S --needed mesa lib32-mesa xf86-video-amdgpu vulkan-radeon lib32-vulkan-radeon
```

### Nvidia

1. 首先需要在[这个网站](https://nouveau.freedesktop.org/CodeNames.html)查找自己的显卡所属的 GPU family。

2. 然后在 [archwiki - NVIDIA](https://wiki.archlinux.org/title/NVIDIA) 页面找到对应的显卡驱动。

    对于 Blackwell 之后的架构，需要根据 linux 内核来选择驱动包。
    - `linux`内核：安装 `nvidia-open`
        ```sh
        sudo pacman -S --needed nvidia-open
        ```
    - `linux-lts`内核：安装 `nvidia-open-lts`
        ```sh
        sudo pacman -S --needed nvidia-open-lts
        ```
    - 其他内核（如`linux-zen`）：安装 `nvidia-open-dkms`
        ```sh
        sudo pacman -S --needed nvidia-open-dkms
        ```

    对于较久版本的架构，需要安装对应的 AUR 包，具体看archwiki。例如 NV160-NV190 之间的，安装 `nvidia-580xx-dkms` 包：
    ```sh
    yay -S --needed nvidia-580xx-dkms
    ```

3. 除此之外还要安装nvidia-utils工具集。在arch上会作为驱动包的依赖安装，但以防万一可以手动加上。

    ```sh
    sudo pacman -S --needed nvidia-utils lib32-nvidia-utils
    ```


## 硬件视频编解码

[archwiki - 硬件视频加速](https://wiki.archlinux.org/title/Hardware_video_acceleration)


1. 根据显卡安装合适的驱动包

    - nvidia

        由`nvidia-utils`和`libva-nvidia-driver`提供

        ```sh
        sudo pacman -S --needed libva-nvidia-driver
        ```

        还可以把替换为`nvidia-vaapi-driver`，按archwiki的说法，这个包的功耗会更低（注意，这个包在archlinuxcn里）。

    - AMD

        自带

    - intel

        Broadwell往后的intel显卡装`intel-media-driver`，旧的装`libva-intel-driver`。具体看archwiki


2. 重启

    ```sh
    reboot
    ```

3. 可选：验证硬件编解码

    ```sh
    pacman -S libva-utils
    ```

    使用`libva-utils`提供的vainfo进行验证
    ```sh
    vainfo
    ```

    多显卡用户可以使用`LIBVA_DRIVER_NAME`环境变量指定要使用的显卡

    ```sh
    LIBVA_DRIVER_NAME=nvidia vainfo
    ```

## 可选：opencl驱动

[archwiki](https://wiki.archlinux.org/title/General-purpose_computing_on_graphics_processing_units#Runtime)

- nvidia

    主要是`opencl-nvidia` `lib32-opencl-nvidia`这两个包。580xx和470xx的用户安装对应的版本，例如：`opencl-nvidia-580xx` `lib32-opencl-nvidia-580xx`

- amd/intel

    ```sh
    sudo pacman -S opencl-mesa lib32-opencl-mesa
    ```





