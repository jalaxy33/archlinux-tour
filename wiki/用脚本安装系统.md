
上篇：安装archlinux的[准备工作](https://github.com/jalaxy33/archlinux-tour/wiki/安装archlinux#准备工作)

这部分用 arch 自带的 `archinstall` 脚本安装系统。



## 更新脚本

```sh
pacman -S archinstall
```


## 开始安装

### 启动脚本

```sh
archinstall
```

前两项是脚本语言和系统本地化设置，保持英文就行，可以后面再改。直接看第三项。


### Mirrors and repositories 设置镜像源

1. 选择第一项`Select regions`设置自己的所在地（如 China）。会调用 reflector 自动选择镜像源，没有执行过此命令的话加载会比较慢，耐心等一等。

2. 选择第三项 `optional repositories` 回车激活 multilib。这是32位程序的源，steam需要，wine运行exe也需要。


### Disk configuration 磁盘分区

关于文件系统、EFI系统分区（ESP）、挂载点等概念请看[这篇文章](https://github.com/SHORiN-KiWATA/ShorinArchExperience-ArchlinuxGuide/wiki/安装ArchLinux#重要概念讲解)


选择 `partitioning` 进入磁盘分区，选择第二项手动分区 > 要使用的硬盘。

#### 1. 创建启动分区

- **创建FAT32分区**：选中要使用的空闲空间 > `Size`（分区大小）512MB > `Filesystem`（文件系统）FAT32 > `Mountpoint`（挂载点）/efi
- **指定为启动分区**：选中刚刚创建的分区，回车设置`bootable`和`esp`。

如果这里没有看到 `esp` 的选项，退出archinstall脚本，检查硬盘分区表是否为GPT类型：[检查方法](https://github.com/jalaxy33/archlinux-tour/wiki/安装archlinux/检查分区表类型)。

#### 2. 可选：创建swap分区

**如果你不需要睡眠功能的话跳过这一步**。睡眠指的是把系统当前状态写入硬盘，然后电脑完全断电，下一次开机恢复到睡眠前的状态。

swap交换空间与虚拟内存和睡眠有关。有swap分区或者swap文件两种方式，前者配置更简单，后者配置稍复杂，但是更加灵活。如果需要配置，可以参考:
- [设置swap分区](https://github.com/SHORiN-KiWATA/ShorinArchExperience-ArchlinuxGuide/wiki/安装ArchLinux#disk-configuration-磁盘分区)
- [设置swap文件](https://github.com/SHORiN-KiWATA/ShorinArchExperience-ArchlinuxGuide/wiki/安装ArchLinux#可选swap交换空间)


#### 3. 创建用户分区（btrfs子卷）

本文使用btrfs文件系统，最大的特点是快照（相当于存档和回档）。**子卷**是btrfs的一个特性，跟快照有关。

通常至少要创建root子卷（存放系统文件）和home子卷（存放用户文件），根据命名规范取名为`@`和`@home`。两者是平级关系，需要分别设置快照。

- **创建btrfs分区**：`Size` 部分直接回车分配全部空间 > `btrfs`
- **设置透明压缩**：回车。选择`Mark/Unmark as compressed`设置透明压缩
- **创建子卷**：再次回车。再选择`Set subvolumes`（创建子卷）> `Add subvolume`。至少需要创建root子卷和home子卷。
    - root子卷：Subvolume name设置成 `@`，对应Subvolume mountpoint是 `/` ； 
    - home子卷：`@home` 对应 `/home`
- **可选：创建其他子卷**：推荐再创建一个子卷，存放不需要被快照备份的数据（我的习惯是叫 `Unsnap`）


`confirm and exit` > back 退出硬盘分区



### Swap（zram交换空间）

这一步是自动帮你配置zram交换空间，yes开启即可。


### Bootloader引导系统

最常用的是Grub，选Grub就行。有其他需求可以看 [archwiki](https://wiki.archlinux.org/title/Arch_boot_process)。

如果你要装进移动存储设备的话激活`Install to removable location`。


### Hostname主机名

设置一个自己想要的主机名。


### Authentication身份认证

- `Root password` 设置管理员密码

- `User account` > `Add a user` 创建普通用户

    Should "" be a superuser(sudo) 是问你要不要给这个用户管理员权限，通常需要一个非root的sudo用户，一般选yes就行。

- `U2F login setup` 这个是物理密钥，有需要的自行设置


### profile 配置

这里可以选择自动安装桌面、最小化安装等等。如果不想现在装桌面就选 `Minimal`，如果想装桌面就选 `Desktop`。 

如果不知道选择安装哪个桌面就从 Gnome 和 KDE Plasma里随便选一个。简单的说，`KDE`更符合windows用户的直觉，功能更丰富但默认设置看着比较乱；`GNOME`更简洁更美观，中文输入法体验更好，但是需要更多配置。

安装桌面：
- **选桌面类型**：`Type` > `Desktop` > 想安装的桌面环境或者窗口管理器
- **选显卡驱动**：`Graphics driver`（自动安装显卡驱动）
    - AMD：选 `AMD/ATi (opensource)`
    - N卡：去[这个网站](https://nouveau.freedesktop.org/CodeNames.html)查看自己的显卡对应的架构 code name。
        - NV160 以后的显卡选`Nvidia (open kernel module ...)`；
        - NV110~NV160 之间的选 `Nvidia (proprietary)`;
        - 再往前的选 `Nvidia (open-source nouveau ...)`


### Applications（蓝牙和音视频）

- Bluetooth > Yes 自动安装蓝牙

- Audio > `pipewire` 自动安装音视频固件

    pipewire是新技术，兼容旧的pulseautio等服务，选pipewire就行了。


### Kernel（系统内核）


要续航选`linux`，要性能选`linux-zen`。推荐多选一个 `linux-lts` 稳定版内核以备不时之需。

tab键选择，回车确认。


### Network configuration （网络配置）

选第三项 `NetworkManager`，因为跟Gnome和KDE Plasma深度集成。有别的需求自行查找。


### Additional packages（自定义安装其他软件包）

`/`左斜杠键进行搜索，tab键选择，回车确认。


- 必装：`vim`或`gvim`（或任意文本编辑器）

- 如果需要配置双系统：`os-prober`（双系统需要）、`exfat-utils`（用于找到windows的EFI分区）

- 可选安装字体：
    - 中文字体：`wqy-zenhei`（文泉驿正黑）或 `adobe-source-han-sans-cn-fonts`（思源黑体）
    - 谷歌开源字体：`noto-fonts`（谷歌开源字体）、`noto-fonts-emoji`（表情）、`noto-fonts-cjk` (中文，可选)、`noto-fonts-extra`（其他字体，可选）

- 如果你使用的是marvell的无线网卡，这里要额外安装`linux-firmware-marvell`，否则进系统找不到网卡。


### Timezone（时区）

`/`左斜杠键搜索，国内搜索 Shanghai


### Automatic time sync (NTP) （自动启用网络时间同步）

默认开启，不用修改


### Install安装

选择`install`安装，安装好之后选择 `exit archinstall`，退出archinstall。



## 下一步：[重启前的工作](https://github.com/jalaxy33/archlinux-tour/wiki/安装后重启前的工作)


